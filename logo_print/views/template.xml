<?xml version="1.0" encoding="UTF-8" ?>
<odoo>


    <!-- product_template_only_website_form_view -->

    <!-- product_product_normal_website_form_view -->
    <!-- product_product_view_form_easy_inherit_website_sale -->

    <!-- product_template_form_view -->
    <!-- product_template_form_view -->


    <!-- Modal dialog form -->
    <template id="product_logo_dialog" name="Modal Dialog">
        <input type="text" name="position_option" id="position_option" value="default"/>

        <t t-set="ptals" t-value="product.valid_product_template_attribute_line_ids"/>
        <t t-set="ptal_printing" t-value="ptals.filtered(lambda ptal: ptal.display_name == 'Printing')"/>
        <t t-set="ptavs_printing"  t-value="ptal_printing.product_template_value_ids._only_active()" />
            
        <table class="table">
            <tbody>
                <tr id="custom-locactions">
                    <t t-foreach="ptavs_printing" t-as="ptav_printing">
                        <td class="text-center" id="locationID18633" style="height: 50px;">
                            <h4>
                                <t t-out="ptav_printing.name"/>
                            </h4>
                            <button type="button" t-attf-value="{{ptav_printing}}" t-attf-onclick="choose_option({{ptav_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                <div class="img-hold">
                                    <img t-attf-src="data:image/png;base64,{{ptav_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                </div>
                            </button>
                        </td>
                    </t>
                </tr>
            </tbody>
        </table>
        
        <script>
            var ptal_printing = "<t t-esc='ptal_printing.attribute_id.id'/>";
            var product_variant_1 = "<t t-esc='ptavs_printing'/>"
            
            function choose_option (position, printing_attribute) {
                console.log("clicked")

                let selection = document.querySelector("#position_option");
                selection.value = position;
                console.log(selection.value);

                let select_opt = document.querySelector("select");
                alert(`${select_opt.dataset.attribute_id}---${ptal_printing}`);

                // assign each selection it's value and hide it
                if (select_opt.dataset.attribute_id === ptal_printing) {
                    select_opt.value = position;
                    console.log("equality");
                }
            }
            
        </script>
    </template>

    <!-- insert the dialog and choose the logo position -->
    <template id="product_logo_inserting" inherit_id="website_sale.product" name="Uploading Logo">
        <xpath expr="//div[@id='o_wsale_cta_wrapper']" position="before">
            <dialog class="rounded" id="dialog">
                <div>
                    <h2>Choose the place of logo:</h2>
                </div>
                <!-- <t t-out="product.product_variant_id"/> -->
                <br/>
                <t t-call="logo_print.product_logo_dialog"></t>

                <button id="close_dialog" value="close" class="btn btn-secondary">Close</button>
            </dialog>
            <div>
                <button id="greeting_id" type="button" class="btn btn-primary">Choose logo position</button>
            </div>
            <br/>
        </xpath>

        <xpath expr="//div[@id='o_product_terms_and_share']" position="before" >
            <!-- <div>
                <form action="" method="post" enctype="">
                    <div class="form-group">
                        <h3 class="css_editable_mode_hidden">Insert Logo</h3>
                        <input type="file" name="image"/>
                    </div>
                    <input class="btn btn-primary" type="submit" value="Submit"/>
                </form>
            </div> -->
            <br/>
      </xpath>
    </template>

    <!-- submit logo in cart template -->
    <template id="submit_logo_in_cart" inherit_id="website_sale.cart_lines">
        <xpath expr="//table[@id='cart_products']//thead//tr//th" position="before">
            <th class="td-img">
                Logo
            </th>
        </xpath>
        <xpath expr="//table[@id='cart_products']//tbody//tr//td" position="before">
            <td>

                <form action="/logo/form/" method="post" enctype="multipart/form-data" data-force_action="sale.order" data-model_name="sale.order">
                    
                    <!-- CSRF Token -->
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"
                    enctype="multipart/form-data" />

                    <input type="hidden" name="order_logo" t-att-value="line" />
                    <input type="hidden" name="product_logo" t-att-value="line.product_id" />
                    
                    <t t-set="description" t-value="line.get_description_following_lines()"/>
                    
                    <input type="hidden" name="describ_logo" t-att-value="description" /> 
                        
                    <input id="sale3" type="file" class="form-control col-xs-2 s_website_form_input" name="a_document" />
                    <button type="submit" class="btn btn-primary">submit</button>
                    
                </form>
            </td>
            
        </xpath>
    </template>

</odoo>

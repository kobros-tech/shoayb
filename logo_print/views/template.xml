<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <!-- Modal dialog form -->
    <template id="product_logo_dialog" name="Modal Dialog">
        
        <!-- variables for the basic logo  -->
        <t t-set="ptals" t-value="product.valid_product_template_attribute_line_ids"/>
        <!-- get the specific attribute according to it's external XMLID -->
        <t t-set="ptal_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position')"/>
        <t t-set="ptavs_printing"  t-value="ptal_printing.product_template_value_ids._only_active()" />
        
        <!-- basic logo table -->
        <div id="first_logo_table" >
            <h2>Choose Logo Location:</h2>
            <table class="table">
                <tbody>
                    <tr id="custom-locactions-1">
                        <t t-foreach="ptavs_printing" t-as="ptav_printing">
                            <td class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_printing}}" t-attf-onclick="choose_option({{ptav_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- yes or no for extra printing attribute -->
        <t t-set="ptal_extra_yes_no" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra1')"/>
        <t t-set="ptavs_extra_y_n_vals"  t-value="ptal_extra_yes_no.product_template_value_ids._only_active()" />
        <t t-set="extra_logo_yes" t-value="ptavs_extra_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra1_yes')" />
        <t t-set="extra_logo_no" t-value="ptavs_extra_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra1_no' )" />

        <!-- variables for the second logo  -->
        <t t-set="ptal_extra_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_1')"/>
        <t t-set="ptavs_extra_printing"  t-value="ptal_extra_printing.product_template_value_ids._only_active()" />

        <!-- second logo table -->
        <div id="second_logo_table" style="display: none;" >
            <h2>Second logo place:</h2>
            <table class="table">
                <tbody>
                    <tr id="custom-locactions-2">
                        <t t-foreach="ptavs_extra_printing" t-as="ptav_extra_printing">
                            <td class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_extra_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_extra_printing}}" t-attf-onclick="choose_extra_option({{ptav_extra_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_extra_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- yes or no for extra 2 printing attribute -->
        <t t-set="ptal_extra2_yes_no" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra2')"/>
        <t t-set="ptavs_extra2_y_n_vals"  t-value="ptal_extra2_yes_no.product_template_value_ids._only_active()" />
        <t t-set="extra2_logo_yes" t-value="ptavs_extra_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra2_yes')" />
        <t t-set="extra2_logo_no" t-value="ptavs_extra_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra2_no' )" />

        <!-- variables for the third logo  -->
        <t t-set="ptal_extra2_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_2')"/>
        <t t-set="ptavs_extra2_printing"  t-value="ptal_extra2_printing.product_template_value_ids._only_active()" />

        <!-- third logo table -->
        <div id="third_logo_table" style="display: none;" >
            <h2>Third logo place:</h2>
            <table class="table">
                <tbody>
                    <tr id="custom-locactions-3">
                        <t t-foreach="ptavs_extra2_printing" t-as="ptav_extra2_printing">
                            <td class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_extra2_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_extra2_printing}}" t-attf-onclick="choose_extra2_option({{ptav_extra2_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_extra2_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- yes or no for extra 3 printing attribute -->
        <t t-set="ptal_extra3_yes_no" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra3')"/>
        <t t-set="ptavs_extra3_y_n_vals"  t-value="ptal_extra3_yes_no.product_template_value_ids._only_active()" />
        <t t-set="extra3_logo_yes" t-value="ptavs_extra3_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra3_yes')" />
        <t t-set="extra3_logo_no" t-value="ptavs_extra_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra3_no' )" />

        <!-- variables for the fourth logo  -->
        <t t-set="ptal_extra3_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_3')"/>
        <t t-set="ptavs_extra3_printing"  t-value="ptal_extra3_printing.product_template_value_ids._only_active()" />

        <!-- fourth logo table -->
        <div id="fourth_logo_table" style="display: none;" >
            <h2>Fourth logo place:</h2>
            <table class="table">
                <tbody>
                    <tr id="custom-locactions-4">
                        <t t-foreach="ptavs_extra3_printing" t-as="ptav_extra3_printing">
                            <td class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_extra3_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_extra3_printing}}" t-attf-onclick="choose_extra3_option({{ptav_extra3_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_extra3_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>

        
        <script>

                var ptal_printing_id = "<t t-esc='ptal_printing.attribute_id.id'/>";
                var extra_y_n_attr_line_id = "<t t-esc='ptal_extra_yes_no.id'/>"
                var extra_y_n_attr_id = "<t t-esc='ptal_extra_yes_no.attribute_id.id'/>";
                var extra_yes_id = "<t t-esc='extra_logo_yes.id'/>"
                var extra_no_id = "<t t-esc='extra_logo_no.id'/>"

                var ptal_extra_printing_id = "<t t-esc='ptal_extra_printing.attribute_id.id'/>"


                // hiding the attributes that are presented in the dialog
                document.addEventListener('DOMContentLoaded', function() {
                    document.querySelectorAll(".variant_attribute").forEach(function(attribute_element) {
                        
                        // hide printing attribute
                        if (attribute_element.dataset.attribute_id === ptal_printing_id) {
                            attribute_element.style.display = "none";
                        }

                        // hide extra printing attribute
                        if (attribute_element.dataset.attribute_id === extra_y_n_attr_id) {
                            attribute_element.style.display = "none";
                        }

                        // hide extra printing choice attribute
                        if (attribute_element.dataset.attribute_id === ptal_extra_printing_id) {
                            attribute_element.style.display = "none";
                        }
                    });
                    
                });


                // set default of extra logo be no
                document.querySelectorAll("select").forEach(function (element) {
                    if (extra_y_n_attr_id === element.dataset.attribute_id) {
                        element.value = extra_no_id;
                    }
                })
                

                
                document.addEventListener('DOMContentLoaded', function() {

                    // defaults for opening the dialog
                    document.querySelector("#second_logo_table").style.display = "none";
                    document.querySelector("#third_logo_table").style.display = "none";
                    document.querySelector("#fourth_logo_table").style.display = "none";
                    document.querySelector("#extra2_logo_choice").style.display = "none";
                    document.querySelector("#extra3_logo_choice").style.display = "none";

                    // This functionality is specific for "Add Second Location" button
                    document.querySelector("#extra_logo_choice").onclick = function() {
                        document.querySelector("#first_logo_table").style.display = "none";
                        document.querySelector("#second_logo_table").style.display = "block";
                        document.querySelector("#extra_logo_choice").style.display = "none";

                        // set the value of extra logo attribute be yes
                        document.querySelectorAll("select").forEach(function (element) {
                            if (extra_y_n_attr_id === element.dataset.attribute_id) {
                                element.value = extra_yes_id;
                            }
                        })

                        return false;
                    }

                    // This functionality is specific for "Add Third Location" button
                    document.querySelector("#extra2_logo_choice").onclick = function() {
                        document.querySelector("#second_logo_table").style.display = "none";
                        document.querySelector("#third_logo_table").style.display = "block";
                        document.querySelector("#extra2_logo_choice").style.display = "none";

                        return false;
                    }

                    // This functionality is specific for "Add Third Location" button
                    document.querySelector("#extra3_logo_choice").onclick = function() {
                        document.querySelector("#third_logo_table").style.display = "none";
                        document.querySelector("#fourth_logo_table").style.display = "block";
                        document.querySelector("#extra3_logo_choice").style.display = "none";

                        return false;
                    }

                });


                function choose_option(position) {
                    document.querySelector("#extra_logo_choice").style.display = "block";

                    // assign a correct value to the first logo attribute
                    document.querySelectorAll("select").forEach(function (element) {
                        if (ptal_printing_id === element.dataset.attribute_id) {
                            element.value = position;
                        }
                    });
                }


                function choose_extra_option(position) {
                    document.querySelector("#extra_logo_choice").style.display = "none";
                    document.querySelector("#extra2_logo_choice").style.display = "block";

                    // assign a correct value to the second logo attribute
                    document.querySelectorAll("select").forEach(function(element) {
                        if (element.dataset.attribute_id === ptal_extra_printing_id) {
                            element.value = position;
                        }
                    });
                }

                function choose_extra2_option(position) {
                    document.querySelector("#extra2_logo_choice").style.display = "none";
                    document.querySelector("#extra3_logo_choice").style.display = "block";
                }

                function choose_extra3_option(position) {
                    document.querySelector("#extra3_logo_choice").style.display = "none";
                    document.querySelector("dialog").close();
                }
                   
                
            </script>
        
    </template>

    <!-- insert the dialog and choose the logo position -->
    <template id="product_logo_inserting" inherit_id="website_sale.product" name="Uploading Logo">
        <xpath expr="//div[@id='o_wsale_cta_wrapper']" position="before">
            <dialog class="rounded" id="dialog">
                
                <!-- <t t-out="product.product_variant_id"/> -->
                <br/>
                <t t-call="logo_print.product_logo_dialog"></t>

                <div>
                    <button id="extra_logo_choice" style="display: none;" class="btn btn-primary">Add Second Location</button>
                    <button id="extra2_logo_choice" style="display: none;" class="btn btn-primary">Add Third Location</button>
                    <button id="extra3_logo_choice" style="display: none;" class="btn btn-primary">Add Fourth Location</button>
                </div>
                <br/>
                <div>
                    <button id="close_dialog" value="close" class="btn btn-secondary">Close</button>
                </div>
            </dialog>
            <div>
                <button id="greeting_id" type="button" class="btn btn-primary">Choose logo position</button>
            </div>
            <br/>
        
            <script>
                
            </script>
        </xpath>
    </template>

    <!-- submit logo in cart template -->
    <template id="submit_logo_in_cart" inherit_id="website_sale.cart_lines">
        <xpath expr="//table[@id='cart_products']//thead//tr//th" position="before">
            <th class="td-img">
                Logo
            </th>
        </xpath>
        <xpath expr="//table[@id='cart_products']//tbody//tr//td" position="before">
            <td id="first_table_data">

                <form id="submisiion_data" action="/logo/form/" method="post" enctype="multipart/form-data" data-force_action="sale.order" data-model_name="sale.order">
                    
                    <!-- CSRF Token -->
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"
                    enctype="multipart/form-data" />

                    <input type="hidden" name="order_logo" t-att-value="line.id" />
                    <input type="hidden" name="product_logo" t-att-value="line.product_id.id" />
                    
                    <t t-set="description" t-value="line.get_description_following_lines()"/>
                    <t t-set="choice" t-value="'Extra_Printing: yes' in description" />
                    
                    <input type="hidden" name="describ_logo" t-att-value="description" /> 
                    
                    <div id="logo_submit">
                        <input id="sale3" type="file" class="form-control col-xs-2 s_website_form_input" name="a_document" />
                    </div>
                    <br/>
                    <div id="exra_submit" style="display: none;">
                        <input id="sale4" type="file" class="form-control col-xs-2 s_website_form_input" name="b_document" />
                    </div>
                    <button id="button_submit" type="submit" onclick="hide_submission()" class="btn btn-primary">submit</button>
                    
                </form>
                    
                <script>

                    
                    var describ_logo = "<t t-esc='description'/>";
                    var choice = "<t t-esc='choice'/>";
                    var order_line = "<t t-esc='line' />";
                    var order_submit = "<t t-esc='line.order_id.library_ids.mapped("id")' />"

                    document.addEventListener('DOMContentLoaded', function() {
                        if ( order_submit != "") {
                            // document.querySelector("#submisiion_data").style.display = "none";
                            // document.querySelector("#first_table_data").innerHTML = "Submitted";
                            // document.querySelector("#first_table_data").style.color = "darkgreen";
                            console.log("logos submitted successfully")
                        }
                    })

                    console.log(choice)
                    if (choice != "") {
                        document.querySelector("#exra_submit").style.display = "block";
                        console.log(describ_logo)
                        console.log(choice)
                    }

                    function hide_submission() {
                        document.querySelector("#submisiion_data").style.display = "none";

                    }

                </script>
            </td>
            
        </xpath>
    </template>

</odoo>

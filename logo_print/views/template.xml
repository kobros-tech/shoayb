<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <!-- Modal dialog form -->
    <template id="product_logo_dialog" name="Modal Dialog">
        
        <!-- variables for the basic logo  -->
        <t t-set="ptals" t-value="product.valid_product_template_attribute_line_ids"/>
        <!-- get the specific attribute according to it's external XMLID -->
        <t t-set="ptal_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position')"/>
        <t t-set="ptavs_printing"  t-value="ptal_printing.product_template_value_ids._only_active()" />
        
        <!-- basic logo table -->
        <div id="first_logo_table" >
            <h2>Choose Logo Location:</h2>
            <table id="table-of-locactions-1" class="table table-borderless">
                <tbody>
                    <tr id="custom-locactions-1">
                        <t t-foreach="ptavs_printing" t-as="ptav_printing">
                            <td t-attf-data-value_id="{{ptav_printing.id}}" t-attf-data-value_name="{{ptav_printing.name}}" class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_printing.id}}" t-attf-onclick="choose_option({{ptav_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- yes or no for extra printing attribute -->
        <t t-set="ptal_extra_yes_no" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra1')"/>
        <t t-set="ptavs_extra_y_n_vals"  t-value="ptal_extra_yes_no.product_template_value_ids._only_active()" />
        <t t-set="extra_logo_yes" t-value="ptavs_extra_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra1_yes')" />
        <t t-set="extra_logo_no" t-value="ptavs_extra_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra1_no' )" />

        <!-- variables for the second logo  -->
        <t t-set="ptal_extra_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_1')"/>
        <t t-set="ptavs_extra_printing"  t-value="ptal_extra_printing.product_template_value_ids._only_active()" />
        <t t-set="extra_position_thanks" t-value="ptavs_extra_printing.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_1_thanks')" />
    
            

        <!-- second logo table -->
        <div id="second_logo_table" style="display: none;" >
            <h2>Second Logo Location:</h2>
            <table id="table-of-locactions-2" class="table table-borderless">
                <tbody>
                    <tr id="custom-locactions-2">
                        <t t-foreach="ptavs_extra_printing" t-as="ptav_extra_printing">
                            <td t-attf-data-value_id="{{ptav_extra_printing.id}}" t-attf-data-value_name="{{ptav_extra_printing.name}}" t-if="ptav_extra_printing != extra_position_thanks" class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_extra_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_extra_printing}}" t-attf-onclick="choose_extra_option({{ptav_extra_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_extra_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- yes or no for extra 2 printing attribute -->
        <t t-set="ptal_extra2_yes_no" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra2')"/>
        <t t-set="ptavs_extra2_y_n_vals"  t-value="ptal_extra2_yes_no.product_template_value_ids._only_active()" />
        <t t-set="extra2_logo_yes" t-value="ptavs_extra2_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra2_yes')" />
        <t t-set="extra2_logo_no" t-value="ptavs_extra2_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra2_no' )" />

        <!-- variables for the third logo  -->
        <t t-set="ptal_extra2_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_2')"/>
        <t t-set="ptavs_extra2_printing"  t-value="ptal_extra2_printing.product_template_value_ids._only_active()" />
        <t t-set="extra_position2_thanks" t-value="ptavs_extra2_printing.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_2_thanks')" />

        <!-- third logo table -->
        <div id="third_logo_table" style="display: none;" >
            <h2>Third Logo Location:</h2>
            <table id="table-of-locactions-3" class="table table-borderless">
                <tbody>
                    <tr id="custom-locactions-3">
                        <t t-foreach="ptavs_extra2_printing" t-as="ptav_extra2_printing">
                            <td t-attf-data-value_id="{{ptav_extra2_printing.id}}" t-attf-data-value_name="{{ptav_extra2_printing.name}}" t-if="ptav_extra2_printing != extra_position2_thanks" class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_extra2_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_extra2_printing}}" t-attf-onclick="choose_extra2_option({{ptav_extra2_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_extra2_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- yes or no for extra 3 printing attribute -->
        <t t-set="ptal_extra3_yes_no" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra3')"/>
        <t t-set="ptavs_extra3_y_n_vals"  t-value="ptal_extra3_yes_no.product_template_value_ids._only_active()" />
        <t t-set="extra3_logo_yes" t-value="ptavs_extra3_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra3_yes')" />
        <t t-set="extra3_logo_no" t-value="ptavs_extra3_y_n_vals.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_extra3_no' )" />

        <!-- variables for the fourth logo  -->
        <t t-set="ptal_extra3_printing" t-value="ptals.filtered(lambda ptal: ptal.attribute_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_3')"/>
        <t t-set="ptavs_extra3_printing"  t-value="ptal_extra3_printing.product_template_value_ids._only_active()" />
        <t t-set="extra_position3_thanks" t-value="ptavs_extra3_printing.filtered(lambda val: val.product_attribute_value_id.get_metadata()[0].get('xmlid') == 'logo_print.product_attribute_logo_position_3_thanks')" />

        <!-- fourth logo table -->
        <div id="fourth_logo_table" style="display: none;" >
            <h2>Fourth Logo Location:</h2>
            <table id="table-of-locactions-4" class="table table-borderless">
                <tbody>
                    <tr id="custom-locactions-4">
                        <t t-foreach="ptavs_extra3_printing" t-as="ptav_extra3_printing">
                            <td t-attf-data-value_id="{{ptav_extra3_printing.id}}" t-attf-data-value_name="{{ptav_extra3_printing.name}}" t-if="ptav_extra3_printing != extra_position3_thanks" class="text-center" style="height: 50px;">
                                <h4>
                                    <t t-out="ptav_extra3_printing.name"/>
                                </h4>
                                <button type="button" t-attf-value="{{ptav_extra3_printing}}" t-attf-onclick="choose_extra3_option({{ptav_extra3_printing.id}})" class="btn btn-dialog" style="background-color: Transparent; background-repeat:no-repeat; border: none; cursor:pointer; overflow: hidden;">
                                    <div class="img-hold">
                                        <img t-attf-src="data:image/png;base64,{{ptav_extra3_printing.product_attribute_value_id.collection_image}}" alt="avatar" class="img-responsive center-block" style="width: 100px"/>
                                    </div>
                                </button>
                            </td>
                        </t>
                    </tr>
                </tbody>
            </table>
        </div>

        
        <script>

                // the primary required position
                var ptal_printing_id = "<t t-esc='ptal_printing.attribute_id.id'/>";

                // the extra 1 choice yes/no
                var extra_y_n_attr_line_id = "<t t-esc='ptal_extra_yes_no.id'/>";
                var extra_y_n_attr_id = "<t t-esc='ptal_extra_yes_no.attribute_id.id'/>";
                var extra_yes_id = "<t t-esc='extra_logo_yes.id'/>";
                var extra_no_id = "<t t-esc='extra_logo_no.id'/>";
                // the extra 1 choice position
                var ptal_extra_printing_id = "<t t-esc='ptal_extra_printing.attribute_id.id'/>";
                var ptal_extra_printing_line_id = "<t t-esc='ptal_extra_printing.id'/>";
                var extra_position_thanks = "<t t-esc='extra_position_thanks.id' />";

                // the extra 2 choice yes/no
                var extra2_y_n_attr_line_id = "<t t-esc='ptal_extra2_yes_no.id'/>";
                var extra2_y_n_attr_id = "<t t-esc='ptal_extra2_yes_no.attribute_id.id'/>";
                var extra2_yes_id = "<t t-esc='extra2_logo_yes.id'/>";
                var extra2_no_id = "<t t-esc='extra2_logo_no.id'/>";
                // the extra 2 choice position
                var ptal_extra2_printing_id = "<t t-esc='ptal_extra2_printing.attribute_id.id'/>";
                var ptal_extra2_printing_line_id = "<t t-esc='ptal_extra2_printing.id'/>";
                var extra_position2_thanks = "<t t-esc='extra_position2_thanks.id' />";

                // the extra 3 choice yes/no
                var extra3_y_n_attr_line_id = "<t t-esc='ptal_extra3_yes_no.id'/>";
                var extra3_y_n_attr_id = "<t t-esc='ptal_extra3_yes_no.attribute_id.id'/>";
                var extra3_yes_id = "<t t-esc='extra3_logo_yes.id'/>";
                var extra3_no_id = "<t t-esc='extra3_logo_no.id'/>";
                // the extra 3 choice position
                var ptal_extra3_printing_id = "<t t-esc='ptal_extra3_printing.attribute_id.id'/>";
                var ptal_extra3_printing_line_id = "<t t-esc='ptal_extra3_printing.id'/>";
                var extra_position3_thanks = "<t t-esc='extra_position3_thanks.id' />";


                document.addEventListener('DOMContentLoaded', function() {

                    // hiding the attributes that are presented in the dialog
                    document.querySelectorAll(".variant_attribute").forEach(function(attribute_element) {
                        
                        // hide printing attribute
                        if (attribute_element.dataset.attribute_id === ptal_printing_id) {
                            // attribute_element.style.display = "none";
                        }

                        // hide extra printing attribute
                        if (attribute_element.dataset.attribute_id === extra_y_n_attr_id) {
                            // attribute_element.style.display = "none";
                        }

                        // hide extra printing choice attribute
                        if (attribute_element.dataset.attribute_id === ptal_extra_printing_id) {
                            // attribute_element.style.display = "none";
                        }

                    });
                    
                    // before loading the page
                    setting_defaults()
                    
                }); // end of DOM
                
                
                document.addEventListener('DOMContentLoaded', function() {

                    // defaults for opening the dialog
                    document.querySelector("#second_logo_table").style.display = "none";
                    document.querySelector("#third_logo_table").style.display = "none";
                    document.querySelector("#fourth_logo_table").style.display = "none";
                    document.querySelector("#extra2_logo_choice").style.display = "none";
                    document.querySelector("#extra3_logo_choice").style.display = "none";

                    // This functionality is specific for "Add Second Location" button
                    document.querySelector("#extra_logo_choice").onclick = function() {
                        document.querySelector("#first_logo_table").style.display = "none";
                        document.querySelector("#second_logo_table").style.display = "block";
                        document.querySelector("#extra_logo_choice").style.display = "none";

                        // set the value of extra logo attribute be yes
                        document.querySelectorAll("select").forEach(function (element) {
                            if (extra_y_n_attr_id === element.dataset.attribute_id) {
                                element.value = extra_yes_id;
                            }
                        })

                        return false;
                    }

                    // This functionality is specific for "Add Third Location" button
                    document.querySelector("#extra2_logo_choice").onclick = function() {
                        document.querySelector("#second_logo_table").style.display = "none";
                        document.querySelector("#third_logo_table").style.display = "block";
                        document.querySelector("#extra2_logo_choice").style.display = "none";

                        // set the value of extra 2 logo attribute be yes
                        document.querySelectorAll("select").forEach(function (element) {
                            if (extra2_y_n_attr_id === element.dataset.attribute_id) {
                                element.value = extra2_yes_id;
                            }
                        })

                        return false;
                    }

                    // This functionality is specific for "Add Third Location" button
                    document.querySelector("#extra3_logo_choice").onclick = function() {
                        document.querySelector("#third_logo_table").style.display = "none";
                        document.querySelector("#fourth_logo_table").style.display = "block";
                        document.querySelector("#extra3_logo_choice").style.display = "none";

                        // set the value of extra 3 logo attribute be yes
                        document.querySelectorAll("select").forEach(function (element) {
                            if (extra3_y_n_attr_id === element.dataset.attribute_id) {
                                element.value = extra3_yes_id;
                            }
                        })

                        return false;
                    }

                }); // end of DOM


                // set defaults of all extra logos be "no" and "no thanks"
                function setting_defaults() {

                    // display all positions for first table
                    let table_1 = document.querySelector("#table-of-locactions-1");
                    table_1.querySelectorAll("td").forEach(function(td) {
                        let button_1 = td.querySelector("button");
                        if (button_1.disabled == true) {
                            button_1.disabled = false;
                        }
                    })
                    // display all positions for second table
                    let table_2 = document.querySelector("#table-of-locactions-2");
                    table_2.querySelectorAll("td").forEach(function(td) {
                        let button_2 = td.querySelector("button");
                        if (button_2.disabled == true) {
                            button_2.disabled = false;
                        }
                    })
                    // display all positions for second table
                    let table_3 = document.querySelector("#table-of-locactions-3");
                    table_3.querySelectorAll("td").forEach(function(td) {
                        let button_3 = td.querySelector("button");
                        if (button_3.disabled == true) {
                            button_3.disabled = false;
                        }
                    })
                    // display all positions for second table
                    let table_4 = document.querySelector("#table-of-locactions-4");
                    table_4.querySelectorAll("td").forEach(function(td) {
                        let button_4 = td.querySelector("button");
                        if (button_4.disabled == true) {
                            button_4.disabled = false;
                        }
                    })
                    
                    
                    document.querySelectorAll("select").forEach(function (element) {
                        // default is no for extra 1 logo
                        if (extra_y_n_attr_id === element.dataset.attribute_id) {
                            element.onchange = function() {
                                // extra position changes according to this element
                                let attr_line_name = `ptal-${ptal_extra_printing_line_id}`;
                                let relevant_position = document.querySelector(`select[name=${attr_line_name}]`);
                                if (element.value === extra_no_id) {
                                    relevant_position.value = extra_position_thanks;
                                }
                            }
                            element.value = extra_no_id;
                        }
                        // default is "no thanks" for extra 1 position
                        if (ptal_extra_printing_id === element.dataset.attribute_id) {
                            element.value = extra_position_thanks;
                        }

                        // default is no for extra 2 logo
                        if (extra2_y_n_attr_id === element.dataset.attribute_id) {
                            element.onchange = function() {
                                // extra position 2 changes according to this element
                                let attr_line_name = `ptal-${ptal_extra2_printing_line_id}`;
                                let relevant_position = document.querySelector(`select[name=${attr_line_name}]`);
                                if (element.value === extra2_no_id) {
                                    relevant_position.value = extra_position2_thanks;
                                }
                            }
                            element.value =  extra2_no_id
                        }
                        // default is "no thanks" for extra 2 position
                        if (ptal_extra2_printing_id === element.dataset.attribute_id) {
                            element.value =  extra_position2_thanks
                        }

                        // default is no for extra 3 logo
                        if (extra3_y_n_attr_id === element.dataset.attribute_id) {
                            element.onchange = function() {
                                // extra position 3 changes according to this element
                                let attr_line_name = `ptal-${ptal_extra3_printing_line_id}`;
                                let relevant_position = document.querySelector(`select[name=${attr_line_name}]`);
                                if (element.value === extra3_no_id) {
                                    relevant_position.value = extra_position3_thanks;
                                }
                            }
                            element.value =  extra3_no_id
                        }
                        // default is "no thanks" for extra 3 position
                        if (ptal_extra3_printing_id === element.dataset.attribute_id) {
                            element.value =  extra_position3_thanks
                        }
                    });
                }


                function choose_option(position) {
                    document.querySelector("#extra_logo_choice").style.display = "block";

                    // assign a correct value to the first logo attribute
                    document.querySelectorAll("select").forEach(function(element) {
                        if (ptal_printing_id === element.dataset.attribute_id) {
                            element.value = position;
                        }
                    });

                    // hide selected position after clicking
                    let table_1 = document.querySelector("#table-of-locactions-1");
                    let disable_name = "";
                    table_1.querySelectorAll("td").forEach(function(td) {
                        td.querySelector("button").disabled = true;

                        if (td.dataset.value_id === position.toString()) {
                            disable_name = td.dataset.value_name
                        }
                    })

                    let table_2 = document.querySelector("#table-of-locactions-2");
                    table_2.querySelectorAll("td").forEach(function(td) {
                        if (td.dataset.value_name === disable_name) {
                            td.querySelector("button").disabled = true;
                        }
                    })

                    let table_3 = document.querySelector("#table-of-locactions-3");
                    table_3.querySelectorAll("td").forEach(function(td) {
                        if (td.dataset.value_name === disable_name) {
                            td.querySelector("button").disabled = true;
                        }
                    })
                    let table_4 = document.querySelector("#table-of-locactions-4");
                    table_4.querySelectorAll("td").forEach(function(td) {
                        if (td.dataset.value_name === disable_name) {
                            td.querySelector("button").disabled = true;
                        }
                    })
                    
                }


                function choose_extra_option(position) {
                    document.querySelector("#extra_logo_choice").style.display = "none";
                    document.querySelector("#extra2_logo_choice").style.display = "block";

                    // assign a correct value to the second logo attribute
                    document.querySelectorAll("select").forEach(function(element) {
                        if (element.dataset.attribute_id === ptal_extra_printing_id) {
                            element.value = position;
                        }
                    });

                    // hide selected position after clicking
                    let table_2 = document.querySelector("#table-of-locactions-2");
                    let disable_name = "";
                    table_2.querySelectorAll("td").forEach(function(td) {
                        td.querySelector("button").disabled = true;

                        if (td.dataset.value_id === position.toString()) {
                            disable_name = td.dataset.value_name
                        }
                    })

                    let table_3 = document.querySelector("#table-of-locactions-3");
                    table_3.querySelectorAll("td").forEach(function(td) {
                        if (td.dataset.value_name === disable_name) {
                            td.querySelector("button").disabled = true;
                        }
                    })

                    let table_4 = document.querySelector("#table-of-locactions-4");
                    table_4.querySelectorAll("td").forEach(function(td) {
                        if (td.dataset.value_name === disable_name) {
                            td.querySelector("button").disabled = true;
                        }
                    })
                }

                function choose_extra2_option(position) {
                    document.querySelector("#extra2_logo_choice").style.display = "none";
                    document.querySelector("#extra3_logo_choice").style.display = "block";

                    // assign a correct value to the third logo attribute
                    document.querySelectorAll("select").forEach(function(element) {
                        if (element.dataset.attribute_id === ptal_extra2_printing_id) {
                            element.value = position;
                        }
                    });

                    // hide selected position after clicking
                    let table_3 = document.querySelector("#table-of-locactions-3");
                    let disable_name = "";
                    table_3.querySelectorAll("td").forEach(function(td) {
                        td.querySelector("button").disabled = true;

                        if (td.dataset.value_id === position.toString()) {
                            disable_name = td.dataset.value_name
                        }
                    })

                    let table_4 = document.querySelector("#table-of-locactions-4");
                    table_4.querySelectorAll("td").forEach(function(td) {
                        if (td.dataset.value_name === disable_name) {
                            td.querySelector("button").disabled = true;
                        }
                    })
                }

                function choose_extra3_option(position) {
                    document.querySelector("#extra3_logo_choice").style.display = "none";

                    // assign a correct value to the fourth logo attribute
                    document.querySelectorAll("select").forEach(function(element) {
                        if (element.dataset.attribute_id === ptal_extra3_printing_id) {
                            element.value = position;
                        }
                    });

                    // hide selected position after clicking
                    let table_4 = document.querySelector("#table-of-locactions-4");
                    let disable_name = "";
                    table_4.querySelectorAll("td").forEach(function(td) {
                        td.querySelector("button").disabled = true;

                        if (td.dataset.value_id === position.toString()) {
                            disable_name = td.dataset.value_name
                        }
                    })

                    document.querySelector("dialog").close();
                }
                                
            </script>
        
    </template>

    <!-- insert the dialog and choose the logo position -->
    <template id="product_logo_inserting" inherit_id="website_sale.product" name="Uploading Logo">
        <xpath expr="//div[@id='o_wsale_cta_wrapper']" position="before">
            <dialog class="rounded" id="dialog_positions">
                
                <!-- <t t-out="product.product_variant_id"/> -->
                <br/>
                <t t-call="logo_print.product_logo_dialog"></t>

                <div>
                    <button id="extra_logo_choice" style="display: none;" class="btn btn-primary">Add Second Location</button>
                    <button id="extra2_logo_choice" style="display: none;" class="btn btn-primary">Add Third Location</button>
                    <button id="extra3_logo_choice" style="display: none;" class="btn btn-primary">Add Fourth Location</button>
                </div>
                <br/>
                <div>
                    <button id="close_dialog" value="close" class="btn btn-secondary rounded-pill">Close</button>
                </div>
            </dialog>
            <div>
                <button id="greeting_id" type="button" class="btn btn-primary">Choose logo position</button>
            </div>
            <br/>
        
            <script>
                
            </script>
        </xpath>
    </template>

    <!-- submit logo in cart template -->
    <template id="submit_logo_in_cart" inherit_id="website_sale.cart_lines">
        <xpath expr="//table[@id='cart_products']//thead//tr//th" position="before">
            <th class="td-img">
                Logo
            </th>
        </xpath>
        <xpath expr="//table[@id='cart_products']//tbody//tr//td" position="before">
            <td id="first_table_data" class="text-center">

                <form id="submisiion_data" action="/logo/form/" method="post" enctype="multipart/form-data" data-force_action="sale.order" data-model_name="sale.order" style="display: none; ">
                    
                    <!-- CSRF Token -->
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"
                    enctype="multipart/form-data" />

                    <input type="hidden" name="order_logo" t-att-value="line.id" />
                    <input type="hidden" name="product_logo" t-att-value="line.product_id.id" />
                    
                    <t t-set="description" t-value="line.get_description_following_lines()"/>
                    <t t-set="choice" t-value="'Extra_Printing: yes' in description" />
                    
                    <input type="hidden" name="describ_logo" t-att-value="description" /> 
                    
                    <div id="logo_submit">
                        <input id="sale3" type="file" class="form-control col-xs-2 s_website_form_input" name="a_document" />
                    </div>
                    <br/>
                    <div id="exra_submit" style="display: none;">
                        <input id="sale4" type="file" class="form-control col-xs-2 s_website_form_input" name="b_document" />
                    </div>
                    <button id="button_submit" type="submit" onclick="hide_submission()" class="btn btn-primary">submit</button>
                    
                </form>

                <!-- tsting json testing json testing json -->
                <br/>
                <dialog class="rounded" t-attf-id="dialog_logos_{{line.id}}">
                    <form t-attf-id="form_json_submit_{{line.id}}" >
                        <div>
                            <h2 t-attf-id="line_json_input_title_{{line.id}}"></h2>
                        </div>
                        <div class="logo_upload" style="display: none;">
                            <img t-attf-id="line_json_img_preview_{{line.id}}" src="" class="img-thumbnail mx-auto rounded d-block" style="width: 100px" />
                        </div>
                        <div class="logo_upload" style="display: none;">
                            <img t-attf-id="line_json_extra1_img_preview_{{line.id}}" src="" class="img-thumbnail mx-auto rounded d-block" style="width: 100px" />
                        </div>
                        <div class="logo_upload" style="display: none;">
                            <img t-attf-id="line_json_extra2_img_preview_{{line.id}}" src="" class="img-thumbnail mx-auto rounded d-block" style="width: 100px" />
                        </div>
                        <div class="logo_upload" style="display: none;">
                            <img t-attf-id="line_json_extra3_img_preview_{{line.id}}" src="" class="img-thumbnail mx-auto rounded d-block" style="width: 100px" />
                        </div>
                        <div>
                            <input t-attf-id="line_json_input_file_{{line.id}}" type="file" accept="image/*" title="Insert logo" class="fa fa-paperclip rounded-pill s_website_form_input mx-auto logo_upload" />
                            <input t-attf-id="line_json_extra1_input_file_{{line.id}}" type="file" accept="image/*" title="Insert extra logo 1" class="fa fa-paperclip rounded-pill s_website_form_input mx-auto logo_upload" style="display: none;"/>
                            <input t-attf-id="line_json_extra2_input_file_{{line.id}}" type="file" accept="image/*" title="Insert extra logo 2" class="fa fa-paperclip rounded-pill s_website_form_input mx-auto logo_upload" style="display: none;"/>
                            <input t-attf-id="line_json_extra3_input_file_{{line.id}}" type="file" accept="image/*" title="Insert extra logo 3" class="fa fa-paperclip rounded-pill s_website_form_input mx-auto logo_upload" style="display: none;"/>
                        </div>
                        <br/>
                        <div>
                            <button t-attf-id="line_json_submit_{{line.id}}" class="btn btn-primary mx-auto logo_upload" style="display: none;">submit the logo</button>
                            <button t-attf-id="line_json_extra1_submit_{{line.id}}" class="btn btn-primary mx-auto logo_upload" style="display: none;">submit the extra 1 logo</button>
                            <button t-attf-id="line_json_extra2_submit_{{line.id}}" class="btn btn-primary mx-auto logo_upload" style="display: none;">submit the extra 2 logo</button>
                            <button t-attf-id="line_json_extra3_submit_{{line.id}}" class="btn btn-primary mx-auto logo_upload" style="display: none;">submit the extra 3 logo</button>
                        </div>
                    </form>
                    <br/>
                    <div class="row">
                        <div class="col-4">
                            <button t-attf-onclick="close_dialog_logos({{line.id}})" value="close" class="btn btn-secondary rounded-pill">Close</button>
                        </div>
                        <div class="col-8">
                            
                        </div>
                    </div>
                    
                </dialog>
                <button t-attf-id="submit_button_{{line.id}}" type="submit" t-attf-onclick="logo_submit({{line.id}})" class="btn fa fa-paperclip rounded-pill s_website_form_input"></button>
                
                <script>

                    var descrip = {};

                    // get the logos description json at page load or at value change
                    document.addEventListener('DOMContentLoaded', function() {
                        document.addEventListener('change', function() {
                            
                        })
                    })

                    // open the dialog
                    function logo_submit(line_id) {

                        console.log("relevant order line id is: ", line_id)

                        let id = `#submit_button_${line_id}`;
                        let form_id = `#form_json_submit_${line_id}`;

                        let input_id = `#line_json_input_file_${line_id}`;
                        let extra1_input_id = `#line_json_extra1_input_file_${line_id}`;
                        let extra2_input_id = `#line_json_extra2_input_file_${line_id}`;
                        let extra3_input_id = `#line_json_extra3_input_file_${line_id}`;

                        let submit_id = `#line_json_submit_${line_id}`;
                        let extra1_submit_id = `#line_json_extra1_submit_${line_id}`;
                        let extra2_submit_id = `#line_json_extra2_submit_${line_id}`;
                        let extra3_submit_id = `#line_json_extra3_submit_${line_id}`;

                        let title_id = `#line_json_input_title_${line_id}`;

                        let img_id = `#line_json_img_preview_${line_id}`;
                        let extra1_img_id = `#line_json_extra1_img_preview_${line_id}`;
                        let extra2_img_id = `#line_json_extra2_img_preview_${line_id}`;
                        let extra3_img_id = `#line_json_extra3_img_preview_${line_id}`;

                        let chooseFile = document.querySelector(input_id);
                        let chooseFile_extra1 = document.querySelector(extra1_input_id);
                        let chooseFile_extra2 = document.querySelector(extra2_input_id);
                        let chooseFile_extra3 = document.querySelector(extra3_input_id);

                        let imgPreview = document.querySelector(img_id);
                        let imgPreview_extra1 = document.querySelector(extra1_img_id);
                        let imgPreview_extra2 = document.querySelector(extra2_img_id);
                        let imgPreview_extra3 = document.querySelector(extra3_img_id);

                        // show the dialog with the title of the first logo position
                        let dialog_ID = `dialog[id=\"dialog_logos_${line_id}\"]`;
                        document.querySelector(dialog_ID).showModal();

                        // get description of specific line in order to submit the correct number of logos
                        fetch(`/logo/get/${line_id}`)
                        .then(function (response) {
                            return response.json()
                        })
                        .then(async function (description) {
                            descrip = await description;
                            // add the title for the first position by opening the dialog
                            console.log(descrip["logo position"])
                            document.querySelector(title_id).innerHTML = await `Add logo for: ${descrip["logo position"]} position`;
                        })

                        // show submitted logo
                        document.querySelector(input_id).addEventListener('change', function () {
                            show_logo_selected(chooseFile, imgPreview, submit_id);
                        })
                        // show submitted extra 1 logo
                        document.querySelector(extra1_input_id).addEventListener('change', function () {
                            show_logo_selected(chooseFile_extra1, imgPreview_extra1, extra1_submit_id);
                        })
                        // show submitted extra 2 logo
                        document.querySelector(extra2_input_id).addEventListener('change', function () {
                            show_logo_selected(chooseFile_extra2, imgPreview_extra2, extra2_submit_id);
                        })
                        // show submitted extra 3 logo
                        document.querySelector(extra3_input_id).addEventListener('change', function () {
                            show_logo_selected(chooseFile_extra3, imgPreview_extra3, extra3_submit_id);
                        })

                        // submit the logo
                        document.querySelector(submit_id).addEventListener('click',
                            async function posting(event) {

                                // Prevents the page from reloading
                                event.preventDefault();

                                let file = document.querySelector(input_id).files[0];
                                let text = await file.text();

                                fetch(`/logo/post/${line_id}`, {
                                    method: 'POST',
                                    body: JSON.stringify({
                                        file: text,
                                        logo_position: descrip["logo position"]
                                    })
                                })
                                .then(function (response) {
                                    return response.json();
                                })
                                .then(function (data) {
                                    console.log("This data: " + data + "\n------ Is sent to server")

                                });
                                
                                if (descrip["extra logo 1"] === "yes") {
                                    document.querySelector(submit_id).style.display = "none";
                                
                                    document.querySelector(input_id).style.display = "none";
                                    document.querySelector(extra1_input_id).style.display = "block";

                                    imgPreview.parentNode.style.display = "none";

                                    // chooseFile.value = [];

                                    // chooseFile = document.querySelector(extra1_input_id);
                                    document.querySelector(title_id).innerHTML = await `Add logo for: ${descrip["extra logo position 1"]} position`;
                                }
                                else {
                                    document.querySelector(submit_id).style.display = "none";
                                
                                    document.querySelector(input_id).style.display = "none";
                                    
                                    imgPreview.parentNode.style.display = "none";

                                    document.querySelector(title_id).innerHTML = "<span>Logos for all selected positions</span><br/><span>are uploaded</span><br/><span>thanks</span>";
                                }
                            }
                        )

                        // submit the extra 1 logo
                        document.querySelector(extra1_submit_id).addEventListener('click',
                            async function posting(event) {
                                
                                // Prevents the page from reloading
                                event.preventDefault();

                                // make post request via fetch to upload the extra 1 logo

                                if (descrip["extra logo 2"] === "yes") {
                                    document.querySelector(extra1_submit_id).style.display = "none";
                                    document.querySelector(extra1_input_id).style.display = "none";
                                    document.querySelector(extra2_input_id).style.display = "block";
                                    imgPreview_extra1.parentNode.style.display = "none";

                                    document.querySelector(title_id).innerHTML = await `Add logo for: ${descrip["extra logo position 2"]} position`;
                                }
                                else {
                                    document.querySelector(extra1_submit_id).style.display = "none";
                                
                                    document.querySelector(extra1_input_id).style.display = "none";
                                    
                                    imgPreview_extra1.parentNode.style.display = "none";

                                    document.querySelector(title_id).innerHTML = "<span>Logos for all selected positions</span><br/><span>are uploaded</span><br/><span>thanks</span>";
                                }
                            }
                        )

                        // submit the extra 2 logo
                        document.querySelector(extra2_submit_id).addEventListener('click',
                            async function posting(event) {
                                
                                // Prevents the page from reloading
                                event.preventDefault();

                                // make post request via fetch to upload the extra 2 logo

                                if (descrip["extra logo 3"] === "yes") {
                                    document.querySelector(extra2_submit_id).style.display = "none";
                                    document.querySelector(extra2_input_id).style.display = "none";
                                    document.querySelector(extra3_input_id).style.display = "block";
                                    imgPreview_extra2.parentNode.style.display = "none";

                                    document.querySelector(title_id).innerHTML = await `Add logo for: ${descrip["extra logo position 3"]} position`;
                                }
                                else {
                                    document.querySelector(extra2_submit_id).style.display = "none";
                                
                                    document.querySelector(extra2_input_id).style.display = "none";
                                    
                                    imgPreview_extra2.parentNode.style.display = "none";

                                    document.querySelector(title_id).innerHTML = "<span>Logos for all selected positions</span><br/><span>are uploaded</span><br/><span>thanks</span>";
                                }
                            }
                        )

                        // submit the extra 3 logo
                        document.querySelector(extra3_submit_id).addEventListener('click',
                            async function posting(event) {
                                
                                // Prevents the page from reloading
                                event.preventDefault();

                                // make post request via fetch to upload the extra 3 logo

                                
                                document.querySelector(extra3_submit_id).style.display = "none";
                                
                                document.querySelector(extra3_input_id).style.display = "none";
                                
                                imgPreview_extra3.parentNode.style.display = "none";

                                document.querySelector(title_id).innerHTML = "<span>Logos for all selected positions</span><br/><span>are uploaded</span><br/><span>thanks</span>";
                                
                            }
                        )


                        function show_logo_selected(chooseFile, imgPreview, next_button) {
                            
                            console.log("call for file", chooseFile)

                            // getImgData(chooseFile, imgPreview);
                            let files = chooseFile.files[0];
                            if (files) {
                                let fileReader = new FileReader();
                                fileReader.readAsDataURL(files);
                                fileReader.addEventListener("load", function () {
                                    imgPreview.style.display = "block";
                                    let link = `${this.result}`;
                                    imgPreview.src = link;
                                    imgPreview.parentNode.style.display = "block";
                                });

                                if (next_button) {
                                    document.querySelector(next_button).style.display = "block";
                                }
                            }
                        }
                        
                        return false;
                    }

                    // close the dialog
                    function close_dialog_logos(line_id) {

                        // close the relevant dialog
                        let dialog_ID = `dialog[id=\"dialog_logos_${line_id}\"]`;
                        document.querySelector(dialog_ID).close();
                    }

                    
                </script><!-- end of tsting json end of testing json end of testing json -->
                    
                <script>

                    
                    var describ_logo = "<t t-esc='description'/>";
                    var choice = "<t t-esc='choice'/>";
                    var order_line = "<t t-esc='line' />";
                    var order_submit = "<t t-esc='line.order_id.library_ids.mapped("id")' />"

                    document.addEventListener('DOMContentLoaded', function() {
                        if ( order_submit != "") {
                            // document.querySelector("#submisiion_data").style.display = "none";
                            // document.querySelector("#first_table_data").innerHTML = "Submitted";
                            // document.querySelector("#first_table_data").style.color = "darkgreen";
                            console.log("logos submitted successfully")
                        }
                    })

                    console.log(choice)
                    if (choice != "") {
                        document.querySelector("#exra_submit").style.display = "block";
                        console.log(describ_logo)
                        console.log(choice)
                    }

                    function hide_submission() {
                        document.querySelector("#submisiion_data").style.display = "none";

                    }

                </script>
            </td>
            
        </xpath>
    </template>

</odoo>
